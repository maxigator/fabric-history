import{Canvas}from"fabric";Canvas.prototype.historyInit=function(){this._historyInit()},Canvas.prototype.dispose=function(s){return function(...t){return s.call(this,...t),this._historyDispose(),this}}(Canvas.prototype.dispose),Canvas.prototype._historyNext=function(){return JSON.stringify(this.toDatalessObject(this.extraProps))},Canvas.prototype._historyEvents=function(){return{"object:added":this._historySaveAction,"object:removed":this._historySaveAction,"object:modified":this._historySaveAction,"object:skewing":this._historySaveAction}},Canvas.prototype._historyInit=function(){this.historyUndo=[],this.historyRedo=[],this.extraProps=["selectable","editable"],this.historyNextState=this._historyNext(),this.on(this._historyEvents())},Canvas.prototype._historyDispose=function(){this.off(this._historyEvents())},Canvas.prototype._historySaveAction=function(){var t;this.historyProcessing||(t=this.historyNextState,this.historyUndo.push(t),this.historyUndo=this.historyUndo.slice(-30),this.historyNextState=this._historyNext(),this.fire("history:append",{json:t}))},Canvas.prototype.undo=async function(){this.historyProcessing=!0;var t=this.historyUndo.pop();t?(this.historyRedo.push(this._historyNext()),this.historyNextState=t,await this._loadHistory(t,"history:undo")):this.historyProcessing=!1},Canvas.prototype.redo=async function(){this.historyProcessing=!0;var t=this.historyRedo.pop();t?(this.historyUndo.push(this._historyNext()),this.historyUndo=this.historyUndo.slice(-30),this.historyNextState=t,await this._loadHistory(t,"history:redo")):this.historyProcessing=!1},Canvas.prototype._loadHistory=async function(t,s){var i=this;await this.loadFromJSON(t),i.renderAll(),i.fire(s),i.historyProcessing=!1},Canvas.prototype.clearHistory=function(){this.historyUndo=[],this.historyRedo=[],this.fire("history:clear")},Canvas.prototype.offHistory=function(){this.historyProcessing=!0},Canvas.prototype.onHistory=function(){this.historyProcessing=!1,this._historySaveAction()};